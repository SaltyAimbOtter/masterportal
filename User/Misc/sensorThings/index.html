
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Masterportal Open Source Community">
      
      
      
        <link rel="prev" href="../translations/">
      
      
        <link rel="next" href="../quickHelp/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.14">
    
    
      
        <title>SensorThings API - Masterportal</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.fad675c6.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.356b1318.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../_docsCustomization/css/contentAreaFullWidth.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="amber" data-md-color-accent="teal">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#sensor-layer" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Masterportal" class="md-header__button md-logo" aria-label="Masterportal" data-md-component="logo">
      
  <img src="../../../_media/Logo_Masterportal.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Masterportal
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              SensorThings API
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="amber" data-md-color-accent="teal"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="amber" data-md-color-accent="teal"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M223.5 32C100 32 0 132.3 0 256s100 224 223.5 224c60.6 0 115.5-24.2 155.8-63.4 5-4.9 6.3-12.5 3.1-18.7s-10.1-9.7-17-8.5c-9.8 1.7-19.8 2.6-30.1 2.6-96.9 0-175.5-78.8-175.5-176 0-65.8 36-123.1 89.3-153.3 6.1-3.5 9.2-10.5 7.7-17.3s-7.3-11.9-14.3-12.5c-6.3-.5-12.6-.8-19-.8z"/></svg>
      </label>
    
  
</form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://bitbucket.org/geowerkstatt-hamburg/masterportal/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    BitBucket
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../Setup/About/" class="md-tabs__link">
          
  
  Setup

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../About/" class="md-tabs__link">
          
  
  User Documentation

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../Developer/About/" class="md-tabs__link">
          
  
  Developer

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Masterportal" class="md-nav__button md-logo" aria-label="Masterportal" data-md-component="logo">
      
  <img src="../../../_media/Logo_Masterportal.svg" alt="logo">

    </a>
    Masterportal
  </label>
  
    <div class="md-nav__source">
      <a href="https://bitbucket.org/geowerkstatt-hamburg/masterportal/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    BitBucket
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Setup
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Setup
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Setup/About/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Setup/quick-start-tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quick Start Tutorial
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    User Documentation
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            User Documentation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../About/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Global Settings
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Global Settings
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Global-Config/services.json/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    services.json
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Global-Config/rest-services.json/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    rest-services.json
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Global-Config/style.json/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    style.json
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Portal Settings
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            Portal Settings
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Portal-Config/config.js/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    config.js
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Portal-Config/config.json/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    config.json
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" checked>
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Miscellaneous
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            Miscellaneous
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../urlParameter/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    URL Parameters
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../translations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Translations
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    SensorThings API
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    SensorThings API
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#definition-of-terms" class="md-nav__link">
    <span class="md-ellipsis">
      Definition of terms
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Definition of terms">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ogc-sensorthingsapi" class="md-nav__link">
    <span class="md-ellipsis">
      OGC SensorThingsAPI
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#frost-server" class="md-nav__link">
    <span class="md-ellipsis">
      FROST Server
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-rest-api-http" class="md-nav__link">
    <span class="md-ellipsis">
      The REST API - HTTP
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-rest-api-mqtt" class="md-nav__link">
    <span class="md-ellipsis">
      The REST API - mqtt
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sensorthingshttp" class="md-nav__link">
    <span class="md-ellipsis">
      SensorThingsHttp
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SensorThingsHttp">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#automatic-split" class="md-nav__link">
    <span class="md-ellipsis">
      Automatic split
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-iotnextlink-value" class="md-nav__link">
    <span class="md-ellipsis">
      The "@iot.nextLink" value
    </span>
  </a>
  
    <nav class="md-nav" aria-label="The "@iot.nextLink" value">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#iotnextlink-structures" class="md-nav__link">
    <span class="md-ellipsis">
      @iot.nextLink structures
    </span>
  </a>
  
    <nav class="md-nav" aria-label="@iot.nextLink structures">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example_1" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#iotnextlink-and-depth-barriers" class="md-nav__link">
    <span class="md-ellipsis">
      @iot.nextLink and depth barriers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-iotcount-value" class="md-nav__link">
    <span class="md-ellipsis">
      The "@iot.count" Value
    </span>
  </a>
  
    <nav class="md-nav" aria-label="The "@iot.count" Value">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example_2" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automatic-use-of-extent" class="md-nav__link">
    <span class="md-ellipsis">
      Automatic use of extent
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-use-of-polygon" class="md-nav__link">
    <span class="md-ellipsis">
      The use of POLYGON
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sensorthingsmqtt" class="md-nav__link">
    <span class="md-ellipsis">
      SensorThingsMqtt
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SensorThingsMqtt">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuration-constructor" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration - Constructor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuration - Constructor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mqtturl" class="md-nav__link">
    <span class="md-ellipsis">
      mqttUrl
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mqttversion" class="md-nav__link">
    <span class="md-ellipsis">
      mqttVersion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rhpath" class="md-nav__link">
    <span class="md-ellipsis">
      rhPath
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration-subscribe" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration - Subscribe
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuration - Subscribe">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rh" class="md-nav__link">
    <span class="md-ellipsis">
      rh
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retained-handling" class="md-nav__link">
    <span class="md-ellipsis">
      Retained Handling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#closing-a-mqtt-connection" class="md-nav__link">
    <span class="md-ellipsis">
      Closing a mqtt connection
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../quickHelp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quick Help Dialog
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" >
        
          
          <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Proxies (deprecated)
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            Proxies (deprecated)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Proxies/proxy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Proxy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Proxies/proxyconf.json/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    proxyconf.json
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Developer
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Developer
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Developer/About/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Developer/setupDev/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Setup
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Tutorials
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Developer/Tutorials/vueTutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Vue Tutorial
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Developer/Tutorials/backboneTutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Backbone Tutorial (deprecated)
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" >
        
          
          <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Tech
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            Tech
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Developer/variables/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Variables
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Developer/fonts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fonts
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_5" >
        
          
          <label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Testing
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            Testing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Developer/Testing/browserTest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit Tests
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Developer/Testing/unittestingBackbone/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Backbone
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Developer/Testing/unitTestVue/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Vue
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_6" >
        
          
          <label class="md-nav__link" for="__nav_4_6" id="__nav_4_6_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Contributing
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6">
            <span class="md-nav__icon md-icon"></span>
            Contributing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Developer/Contributing/gitWorkflow/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Git Workflow
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Developer/Contributing/codingConventions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Coding Conventions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Developer/Contributing/codingConventionsInfo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Coding Conventions Info
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Developer/Contributing/library_evaluation/Library_Evaluation.pdf" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Library Evaluation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Developer/Contributing/versioning/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Versioning
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#definition-of-terms" class="md-nav__link">
    <span class="md-ellipsis">
      Definition of terms
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Definition of terms">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ogc-sensorthingsapi" class="md-nav__link">
    <span class="md-ellipsis">
      OGC SensorThingsAPI
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#frost-server" class="md-nav__link">
    <span class="md-ellipsis">
      FROST Server
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-rest-api-http" class="md-nav__link">
    <span class="md-ellipsis">
      The REST API - HTTP
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-rest-api-mqtt" class="md-nav__link">
    <span class="md-ellipsis">
      The REST API - mqtt
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sensorthingshttp" class="md-nav__link">
    <span class="md-ellipsis">
      SensorThingsHttp
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SensorThingsHttp">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#automatic-split" class="md-nav__link">
    <span class="md-ellipsis">
      Automatic split
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-iotnextlink-value" class="md-nav__link">
    <span class="md-ellipsis">
      The "@iot.nextLink" value
    </span>
  </a>
  
    <nav class="md-nav" aria-label="The "@iot.nextLink" value">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#iotnextlink-structures" class="md-nav__link">
    <span class="md-ellipsis">
      @iot.nextLink structures
    </span>
  </a>
  
    <nav class="md-nav" aria-label="@iot.nextLink structures">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example_1" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#iotnextlink-and-depth-barriers" class="md-nav__link">
    <span class="md-ellipsis">
      @iot.nextLink and depth barriers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-iotcount-value" class="md-nav__link">
    <span class="md-ellipsis">
      The "@iot.count" Value
    </span>
  </a>
  
    <nav class="md-nav" aria-label="The "@iot.count" Value">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example_2" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automatic-use-of-extent" class="md-nav__link">
    <span class="md-ellipsis">
      Automatic use of extent
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-use-of-polygon" class="md-nav__link">
    <span class="md-ellipsis">
      The use of POLYGON
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sensorthingsmqtt" class="md-nav__link">
    <span class="md-ellipsis">
      SensorThingsMqtt
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SensorThingsMqtt">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuration-constructor" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration - Constructor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuration - Constructor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mqtturl" class="md-nav__link">
    <span class="md-ellipsis">
      mqttUrl
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mqttversion" class="md-nav__link">
    <span class="md-ellipsis">
      mqttVersion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rhpath" class="md-nav__link">
    <span class="md-ellipsis">
      rhPath
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration-subscribe" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration - Subscribe
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuration - Subscribe">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rh" class="md-nav__link">
    <span class="md-ellipsis">
      rh
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retained-handling" class="md-nav__link">
    <span class="md-ellipsis">
      Retained Handling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#closing-a-mqtt-connection" class="md-nav__link">
    <span class="md-ellipsis">
      Closing a mqtt connection
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
    <a href="https://bitbucket.org/geowerkstatt-hamburg/masterportal/src/default/docs/User/Misc/sensorThings.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg>
    </a>
  
  


<h1 id="sensor-layer">Sensor Layer<a class="headerlink" href="#sensor-layer" title="Copy heading link to clipboard">🔗</a></h1>
<p>This document describes the technical details of the Masterportal's sensor layer based on the <em>SensorThingsAPI</em>.</p>
<h2 id="definition-of-terms">Definition of terms<a class="headerlink" href="#definition-of-terms" title="Copy heading link to clipboard">🔗</a></h2>
<h3 id="ogc-sensorthingsapi">OGC SensorThingsAPI<a class="headerlink" href="#ogc-sensorthingsapi" title="Copy heading link to clipboard">🔗</a></h3>
<p>The OGC's (Open Geospatial Consortium) SensorThingsAPI "provides an open standard-based and geospatial-enabled framework to interconnect the Internet of Things devices, data, and applications over the Web." (<a href="https://docs.opengeospatial.org/is/15-078r6/15-078r6.html#6">source</a>) The framework provides a data model describing the connection between the "Broker" (Server), a network of "Publishers" (Sensors), and "Clients" (in this case, the Masterportal application).</p>
<p>For more information on the open standard-based <em>SensorThingsAPI</em>, visit:</p>
<ul>
<li><a href="https://docs.opengeospatial.org/is/15-078r6/15-078r6.html#1">https://docs.opengeospatial.org/is/15-078r6/15-078r6.html#1</a></li>
<li><a href="http://developers.sensorup.com/docs/">http://developers.sensorup.com/docs/</a></li>
<li><a href="https://gost1.docs.apiary.io/#reference/0/things">https://gost1.docs.apiary.io/#reference/0/things</a></li>
</ul>
<p>For a quick overview of the data model, see <a href="http://docs.opengeospatial.org/is/15-078r6/15-078r6.html#24">The Sensing Entities</a>.</p>
<h3 id="frost-server">FROST Server<a class="headerlink" href="#frost-server" title="Copy heading link to clipboard">🔗</a></h3>
<p>The FROST Server is an open source SensorThings Server developed by the Fraunhofer Institut. It is "a Server implementation of the OGC SensorThings API." (<a href="https://github.com/FraunhoferIOSB/FROST-Server">source</a>) It acts as the Broker, establishing a link between Publishers (sensors) and the Client (Masterportal, browser). Calls to the FROST Server can be in pure <em>http</em> to use its REST API, or you may establish a bidirectional link via <em>mqtt</em> or <em>CoAP</em>.</p>
<h3 id="the-rest-api-http">The REST API - HTTP<a class="headerlink" href="#the-rest-api-http" title="Copy heading link to clipboard">🔗</a></h3>
<p>To subscribe to required IDs of Things, use a HTTP REST call to fetch all required IDs.</p>
<blockquote>
<p>⚠️ <code>expand</code>, <code>filter</code>, and so on as URL query parameters are usable with HTTP REST calls only. With mqtt, you may subscribe to a plain path, and URL queries ("?" and beyond) will be ignored.</p>
</blockquote>
<p>Basic examples for data calls via REST API:</p>
<ul>
<li><a href="https://iot.hamburg.de/">Overview</a></li>
<li><a href="https://iot.hamburg.de/v1.0/Things">All things of the SensorThingsAPI</a></li>
<li><a href="https://iot.hamburg.de/v1.0/Things(26)">One thing of the SensorThingsAPI</a></li>
<li><a href="https://iot.hamburg.de/v1.0/Datastreams(74)">One data stream</a></li>
<li><a href="https://iot.hamburg.de/v1.0/Things(26)/Datastreams">All data streams of one thing</a></li>
<li><a href="https://iot.hamburg.de/v1.0/Datastreams(74)/Observations">All observations of a data stream</a></li>
</ul>
<p>The FROST Server implements a REST API that allows you to <code>expand</code> and <code>filter</code> the query based on a query language comparable to SQL. To join tables, use the <code>$expand</code> tag as URL query parameter, and separate multiple joins with a comma.</p>
<ul>
<li><a href="https://iot.hamburg.de/v1.0/Things(26)?$expand=Locations">One Thing with its Location</a></li>
<li><a href="https://iot.hamburg.de/v1.0/Things(26)?$expand=Locations,Datastreams/Observations">One Thing with its Location and Observations</a> (note that observations are in relation to data streams, not things)</li>
</ul>
<p>To filter things without knowing their identifier, use <code>$filter</code> as URL query parameter.</p>
<ul>
<li><a href="https://iot.hamburg.de/v1.0/Things?$filter=name%20eq%20%27StadtRad-Station%20Grandweg%20/%20Veilchenweg%27">Find a Thing by its name with <code>$filter=name eq '...'</code></a></li>
</ul>
<p>To order things, use <code>$orderby</code>. This can e.g. be used to retrieve the latest Observation by ordering Observations descending by date and adding <code>$top=1</code> to fetch the first element only.</p>
<ul>
<li><a href="https://iot.hamburg.de/v1.0/Datastreams(74)/Observations?$orderby=phenomenonTime%20desc&amp;$top=1">Order the Observations and pick the first one using <code>$orderby=phenomenonTime desc&amp;$top=1</code></a></li>
</ul>
<p>You may also use nested statements:</p>
<ul>
<li><a href="http://iot.hamburg.de/v1.0/Things(614)?$expand=Datastreams($expand=Observations),Locations"><code>?$expand=Datastreams($expand=Observations),Locations</code></a></li>
</ul>
<p>To retrieve Things within an extent, use a <code>POLYGON</code>:</p>
<ul>
<li><a href="https://iot.hamburg.de/v1.0/Things?$filter=startswith(Things/name,%27StadtRad-Station%27)%20and%20st_within(Locations/location,geography%27POLYGON%20((10.0270%2053.5695,10.0370%2053.5695,10.0370%2053.5795,10.0270%2053.5795,10.0270%2053.5695))%27)&amp;$expand=Locations">Retrieve things within a polygon</a></li>
</ul>
<p>URL in detail:</p>
<ul>
<li>https://iot.hamburg.de/v1.0/Things?</li>
<li>$filter=</li>
<li>startswith(Things/name,'StadtRad-Station')</li>
<li>and st_within(<ul>
<li>Locations/location,geograph'POLYGON ((</li>
<li>10.0270 53.5695,</li>
<li>10.0370 53.5695,</li>
<li>10.0370 53.5795,</li>
<li>10.0270 53.5795,</li>
<li>10.0270 53.5695</li>
<li>))'</li>
</ul>
</li>
<li>)</li>
<li>&amp;$expand=Locations</li>
</ul>
<p>You will only receive Things located within the given polygon. Use this to increase network request speed by only retrieving and subscribing to Things in the user's current view.</p>
<h3 id="the-rest-api-mqtt">The REST API - mqtt<a class="headerlink" href="#the-rest-api-mqtt" title="Copy heading link to clipboard">🔗</a></h3>
<p>mqtt is a protocol developed for the <em>Internet of Things</em> to keep an open connection to servers and communicate with pull (commands from client to server) and push (messages from server to client) requests, using an established connection that does not close in the meantime.</p>
<p>In the browser, this might e.g. be implemented by using socket.io.</p>
<p>If you use npm, refer to the mqtt package instead.</p>
<p>The Client uses the mqtt protocol to subscribe to a Topic. A Topic is a plain path to something, e.g. <code>v1.0/Datastreams(74)/Observations</code>. Note that the host is given to mqtt during the connect operation, and is omitted during further interaction.</p>
<p>After subscribing to a Topic (e.g. <code>v1.0/Datastreams(74)/Observations</code>), the server will push every new message (in this case, a new Observation in Datastream 74), using the opened mqtt connection, to the Client.</p>
<p>As mqtt may only subscribe and unsubscribe Topics, you have to use HTTP requests (as shown above) to assemble the parts of your Topic. All entities of the SensorThingsAPI can be requested as Topic.</p>
<p>As mentioned before, you can only subscribe to plain REST URLs. Everything in the query part will be ignored:</p>
<ul>
<li>positive mqtt example: <code>mqtt://iot.hamburg.de/v1.0/Datastreams(74)/Observations</code></li>
<li>negative mqtt example: <code>mqtt://iot.hamburg.de/v1.0/Datastreams(74)?$expand=Observations</code></li>
</ul>
<p>Currently used mqtt versions:</p>
<ul>
<li><a href="http://public.dhe.ibm.com/software/dw/webservices/ws-mqtt/mqtt-v3r1.html">mqtt v3.1</a></li>
<li><a href="https://docs.oasis-open.org/mqtt/mqtt/v3.1.1/mqtt-v3.1.1.html">mqtt v3.1.1</a></li>
<li><a href="https://docs.oasis-open.org/mqtt/mqtt/v5.0/os/mqtt-v5.0-os.html">mqtt v5.0</a></li>
</ul>
<h2 id="sensorthingshttp">SensorThingsHttp<a class="headerlink" href="#sensorthingshttp" title="Copy heading link to clipboard">🔗</a></h2>
<p>The SensorThingsAPI provides automatic splitting of server responses to chunks to avoid overly large payloads. This allows displaying the progress of SensorThingsAPI calls for improved user experience. See <a href="#markdown-header-automatic-split">Automatic Split</a> for details.</p>
<p>The request can be minimized further by limiting it to the extent currently visible in the browser. See <a href="#markdown-header-automatic-call-in-extent">Automatic call in Extent</a> for details.</p>
<p>The Masterportal implements a software layer called <code>SensorThingsHttp</code> that provides the both split and extent handling.</p>
<blockquote>
<p>⚠️ Please mind that automatic progress and "call in extent" are only available if your server side implementation of the SensorThingsAPI (e.g. the FROST Server) provides - <em>and has set to active!</em> - the skip and geography functions.</p>
</blockquote>
<h3 id="automatic-split">Automatic split<a class="headerlink" href="#automatic-split" title="Copy heading link to clipboard">🔗</a></h3>
<p>Your server configuration should activate the automatic splitting of responses. When activated, responses too large for a single response will contain a follow-up link ("@iot.nextLink") to the next data chunk. The total number of chunks is included as "@iot.count" value.</p>
<p>Using the <code>SensorThingsHttp.get()</code> function, the <code>SensorThingsHttp</code> layer handles "@iot.nextLink" (see <a href="#markdown-header-the-iotnextlink-value">The "@iot.nextLink" Value</a>) and "@iot.count" (see <a href="#markdown-header-the-iotcount-value">The "@iot.count" Value</a>) for you.</p>
<p>Here is a basic implementation of <code>SensorThingsHttp</code>, using basic events of the Masterportal, to show its functionality:</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="nx">SensorThingsHttp</span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@src/utils/sensorThingsHttp&quot;</span><span class="p">;</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="k">import</span><span class="w"> </span><span class="nx">LoaderOverlay</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;/src/utils/loaderOverlay&quot;</span><span class="p">;</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="kd">const</span><span class="w"> </span><span class="nx">http</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">SensorThingsHttp</span><span class="p">(),</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="w">    </span><span class="nx">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;https://iot.hamburg.de/v1.0/Things&quot;</span><span class="p">;</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="nx">http</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">response</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="w">    </span><span class="c1">// onsuccess</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="w">    </span><span class="c1">// do something with the complete response</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="p">},</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="w">    </span><span class="c1">// onstart</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="w">    </span><span class="nx">LoaderOverlay</span><span class="p">.</span><span class="nx">show</span><span class="p">();</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="p">},</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="w">    </span><span class="c1">// oncomplete (always called finally)</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="w">    </span><span class="nx">LoaderOverlay</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="p">},</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="w">    </span><span class="c1">// onerror</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="p">},</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">progress</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a><span class="w">    </span><span class="c1">// onprogress</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a><span class="w">    </span><span class="c1">// the progress (percentage = Math.round(progress * 100)) to update your progress bar with</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a><span class="p">});</span>
</span></code></pre></div>
<p>Please note that the <code>http.get</code> call in itself is asynchronous. All parameters of <code>SensorThingsHttp.get()</code>, except for <code>url</code>, are optional. At least a function for <code>onsuccess</code> should be provided anyway, or the response is lost.</p>
<h3 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Copy heading link to clipboard">🔗</a></h3>
<p>SensorThingsHttp can be configured with two parameters via constructor.</p>
<table>
<thead>
<tr>
<th>name</th>
<th>mandatory</th>
<th>type</th>
<th>default</th>
<th>description</th>
<th>example</th>
</tr>
</thead>
<tbody>
<tr>
<td>removeIotLinks</td>
<td>No</td>
<td>Boolean</td>
<td>false</td>
<td>removes all "@iot.navigationLink" and "@iot.selfLink" from the response to reduce the size of the result</td>
<td><code>const http = new SensorThingsHttp({removeIotLinks: true});</code></td>
</tr>
<tr>
<td>httpClient</td>
<td>No</td>
<td>Function</td>
<td>null</td>
<td>can be used to change the default http handler (in our case axios), e.g. for testing</td>
<td><code>const http = new SensorThingsHttp({httpClient: (url, onsuccess, onerror) =&gt; {}});</code></td>
</tr>
</tbody>
</table>
<h3 id="the-iotnextlink-value">The "@iot.nextLink" value<a class="headerlink" href="#the-iotnextlink-value" title="Copy heading link to clipboard">🔗</a></h3>
<p>If you don't want to use <code>SensorThingsHttp</code> to automatically split the data, here are some hints regarding your implementation.</p>
<p>If a call's response contains too many datasets, the server splits the result into chunks, indicated by a "@iot.nextLink" for the follow-up chunk. You can follow through all "@iot.nextLink" URLs, gathering the responses until the end of data is received. If no follow-up link ("@iot.nextLink") exists, all chunks have been retrieved.</p>
<h4 id="example">Example<a class="headerlink" href="#example" title="Copy heading link to clipboard">🔗</a></h4>
<p>The following URL will fetch 100 datasets, and the response will include an "@iot.nextLink" to the next chunk: <a href="https://iot.hamburg.de/v1.0/Things">All Things</a></p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="p">{</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="w">  </span><span class="nt">&quot;@iot.nextLink&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://iot.hamburg.de/v1.0/Things?$skip=100&quot;</span><span class="p">,</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">  </span><span class="nt">&quot;value&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[{</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">      </span><span class="nt">&quot;...&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;...&quot;</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="w">  </span><span class="p">}]</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="p">}</span>
</span></code></pre></div>
<p>Calling the nextLink (<a href="https://iot.hamburg.de/v1.0/Things?$skip=100">https://iot.hamburg.de/v1.0/Things?$skip=100</a>) provides you with the next chunk of data and another follow-up link ("@iot.nextLink") and so on, until the last dataset is reached.</p>
<h3 id="iotnextlink-structures">@iot.nextLink structures<a class="headerlink" href="#iotnextlink-structures" title="Copy heading link to clipboard">🔗</a></h3>
<p>If you don't want to use <code>SensorThingsHttp</code> to automatically follow @iot.nextLinks, please mind the following hint.</p>
<p>Complex calls to the SensorThingsAPI may result in many chunks. The FROST Server is capable to split any delivered array - also in sub-structures - and provide them with an @iot.nextLink. These links hold the split array's key as prefix; e.g. Observations@iot.nextLink, or Datastreams@iot.nextLink.</p>
<h4 id="example_1">Example<a class="headerlink" href="#example_1" title="Copy heading link to clipboard">🔗</a></h4>
<ul>
<li>URL: <a href="https://udh-hh-iot-qs.germanynortheast.cloudapp.microsoftazure.de/v1.0/Things?$expand=Datastreams($top=2;$expand=Observations($top=2))">https://udh-hh-iot-qs.germanynortheast.cloudapp.microsoftazure.de/v1.0/Things?$expand=Datastreams($top=2;$expand=Observations($top=2))</a></li>
<li>Response: Many Things, with lots of Datastreams and Observations.</li>
<li>Hint: In this example, we use <code>$top=2</code> to enforce splitting with [prefix]@iot.nextLink on any expanded sublevel.</li>
</ul>
<div class="language-json highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="p">{</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">    </span><span class="nt">&quot;@iot.nextLink&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://udh-hh-iot-qs.germanynortheast.cloudapp.microsoftazure.de/v1.0/Things?$skip=100&amp;$expand=Datastreams%28%24top%3D2%3B%24expand%3DObservations%28%24top%3D2%29%29&quot;</span><span class="p">,</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">    </span><span class="nt">&quot;value&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">        </span><span class="nt">&quot;Datastreams&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="w">            </span><span class="nt">&quot;Observations&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="err">...</span><span class="p">],</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="w">            </span><span class="nt">&quot;Observations@iot.nextLink&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://udh-hh-iot-qs.germanynortheast.cloudapp.microsoftazure.de/v1.0/Datastreams(13976)/Observations?$top=2&amp;$skip=2&quot;</span><span class="p">,</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="w">        </span><span class="p">},</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="w">            </span><span class="nt">&quot;Observations&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="err">...</span><span class="p">],</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="w">            </span><span class="nt">&quot;Observations@iot.nextLink&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://udh-hh-iot-qs.germanynortheast.cloudapp.microsoftazure.de/v1.0/Datastreams(13978)/Observations?$top=2&amp;$skip=2&quot;</span><span class="p">,</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="p">],</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="w">        </span><span class="nt">&quot;Datastreams@iot.nextLink&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://udh-hh-iot-qs.germanynortheast.cloudapp.microsoftazure.de/v1.0/Things(5432)/Datastreams?$top=2&amp;$skip=2&amp;$expand=Observations%28%24top%3D2%29&quot;</span><span class="p">,</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="w">    </span><span class="p">}]</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="p">}</span>
</span></code></pre></div>
<p>On following the <a href="https://udh-hh-iot-qs.germanynortheast.cloudapp.microsoftazure.de/v1.0/Things(5432)/Datastreams?$top=2&amp;$skip=2&amp;$expand=Observations%28%24top%3D2%29">Datastreams@iot.nextLink</a>, a structure describing further Datastreams is returned:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="p">{</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">    </span><span class="nt">&quot;@iot.nextLink&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://udh-hh-iot-qs.germanynortheast.cloudapp.microsoftazure.de/v1.0/Things(5432)/Datastreams?$top=2&amp;$skip=4&amp;$expand=Observations%28%24top%3D2%29&quot;</span><span class="p">,</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">    </span><span class="nt">&quot;value&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">        </span><span class="nt">&quot;Observations&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="err">...</span><span class="p">],</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">        </span><span class="nt">&quot;Observations@iot.nextLink&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://udh-hh-iot-qs.germanynortheast.cloudapp.microsoftazure.de/v1.0/Datastreams(13980)/Observations?$top=2&amp;$skip=2&quot;</span><span class="p">,</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="w">    </span><span class="p">}]</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="p">}</span>
</span></code></pre></div>
<p>Keep in mind that a single Thing has neither an @iot.nextLink, nor a "value" key. E.g. <a href="https://udh-hh-iot-qs.germanynortheast.cloudapp.microsoftazure.de/v1.0/Things(5432)?$expand=Datastreams($top=2)">this link</a> returns such a feature. Still, this case contains [prefix]@iot.nextLinks to follow in nested structures.</p>
<h3 id="iotnextlink-and-depth-barriers">@iot.nextLink and depth barriers<a class="headerlink" href="#iotnextlink-and-depth-barriers" title="Copy heading link to clipboard">🔗</a></h3>
<p>The end of @iot.nextLink follow-ups is marked by the absence of a next @iot.nextLink to follow.</p>
<p>However: If you limit the response using <code>$top=X</code> (with X being the number of entities to load), an @iot.nextLink may exist.
Following these links will lead to a cascade of server calls - for example, <code>$top=1</code> on a request that would return 1000 entities would start 1000 server calls, slowing down the system immensely.</p>
<p><a href="https://udh-hh-iot-qs.germanynortheast.cloudapp.microsoftazure.de/v1.0/Datastreams(13980)/Observations?$top=1">Example call for this scenario</a>
<div class="language-json highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="p">{</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="w">  </span><span class="nt">&quot;@iot.nextLink&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://udh-hh-iot-qs.germanynortheast.cloudapp.microsoftazure.de/v1.0/Datastreams(13980)/Observations?$top=1&amp;$skip=1&quot;</span><span class="p">,</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">  </span><span class="nt">&quot;value&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="err">...</span><span class="p">}</span><span class="w"> </span><span class="p">]</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="p">}</span>
</span></code></pre></div></p>
<p>Unfortunately, you may not simply ignore @iot.nextLinks if you find a <code>$top=X</code> in the @iot.nextLink, as the X in <code>$top=X</code> may exceed "the service-driven pagination limitation", and multiple requests are required to actually retrieve X entities:</p>
<blockquote>
<p>"In addition, if the $top value exceeds the service-driven pagination limitation (...), the $top query option SHALL be discarded and the server-side pagination limitation SHALL be imposed." (<a href="https://docs.opengeospatial.org/is/15-078r6/15-078r6.html#51">source</a>)</p>
</blockquote>
<p>An @iot.nextLink search for <code>$top=X</code> or <code>%24top=X</code> in combination with <code>$skip=Y</code> or <code>%24skip=Y</code> will do the trick, as any <code>$top=X</code> not related to the root structure is url encoded with "%3D" instead of "=".</p>
<p>Example: <a href="https://udh-hh-iot-qs.germanynortheast.cloudapp.microsoftazure.de/v1.0/Things(5432)/Datastreams?%24top=2&amp;%24skip=2&amp;%24expand=Observations%28%24top%3D2%29">https://udh-hh-iot-qs.germanynortheast.cloudapp.microsoftazure.de/v1.0/Things(5432)/Datastreams?%24top=2&amp;%24skip=2&amp;%24expand=Observations%28%24top%3D2%29</a></p>
<ul>
<li>Regex for <code>$top=X</code>: <code>/[\$|%24]top=([0-9]+)/</code></li>
<li>Regex for <code>$skip=X</code>: <code>/[\$|%24]skip=([0-9]+)/</code></li>
</ul>
<p>Use this pseudo-code as guideline for your additional depth barrier:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>// pseudo code, some nextLink is given
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>int topX = fetchTopFromNextLink(nextLink);
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>int skipX = fetchSkipFromNextLink(nextLink);
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>if (topX &gt; 0 &amp;&amp; topX &lt;= skipX) {
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>    // do not follow (depth barrier reached)
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>}
</span></code></pre></div>
<h3 id="the-iotcount-value">The "@iot.count" Value<a class="headerlink" href="#the-iotcount-value" title="Copy heading link to clipboard">🔗</a></h3>
<p>The number of expected chunks can be requested by adding <code>$count=true</code> to the call, which will fill the value for "@iot.count" in the response.</p>
<p>This total number in combination with the current skip value can be used to calculate the loading progress of the application, which may then be shown to the user by a loading bar or other UI elements.</p>
<h4 id="example_2">Example<a class="headerlink" href="#example_2" title="Copy heading link to clipboard">🔗</a></h4>
<p>To get the total number of datasets to expect from a call, simply add <code>$count=true</code> to any <em>SensorThingsAPI</em> URL: <a href="https://iot.hamburg.de/v1.0/Things?$count=true">https://iot.hamburg.de/v1.0/Things?$count=true</a></p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="p">{</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="w">  </span><span class="nt">&quot;@iot.count&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">4723</span><span class="p">,</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="w">  </span><span class="nt">&quot;@iot.nextLink&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://iot.hamburg.de/v1.0/Things?$skip=100&amp;$count=true&quot;</span><span class="p">,</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="w">  </span><span class="nt">&quot;value&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="w">      </span><span class="nt">&quot;...&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;...&quot;</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="w">  </span><span class="p">}]</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="p">}</span>
</span></code></pre></div>
<p>Combining the absolute number ("@iot.count") and the value of the current <code>$skip</code> parameter gives you the progress with <code>1 / @iot.count * skip</code>.</p>
<h3 id="automatic-use-of-extent">Automatic use of extent<a class="headerlink" href="#automatic-use-of-extent" title="Copy heading link to clipboard">🔗</a></h3>
<p>You may want your server implementation of the <em>SensorThingsAPI</em> (e.g. the FROST Server) to return data only within a given extent (e.g. a polygon). The FROST Server provides you with this functionality. To use this feature, the <code>SensorThingsHttp</code> layer provides a method <code>SensorThingsHttp.getInExtent()</code> to retrieve data only within the given extent.</p>
<p>Using <code>SensorThingsHttp.getInExtent()</code>, you may also use the splitting progress explained <a href="#markdown-header-automatic-split">above</a>. The <code>SensorThingsHttp</code> layer creates the correct URL query parameter <code>st_within(Locations/location,geography'POLYGON ((...))')</code> (see <a href="#the_use_of_polygon">The use of POLYGON</a>) for you.</p>
<p>The extent needs to be described including its source projection and target projection. The following extent options are mandatory for the use of <code>SensorThingsHttp.getInExtent()</code>:</p>
<table>
<thead>
<tr>
<th>name</th>
<th>mandatory</th>
<th>type</th>
<th>default</th>
<th>description</th>
<th>example</th>
</tr>
</thead>
<tbody>
<tr>
<td>extent</td>
<td>yes</td>
<td>Number[]</td>
<td>-</td>
<td>the extent of your current view</td>
<td>[556925.7670922858, 5925584.829527992, 573934.2329077142, 5942355.170472008]</td>
</tr>
<tr>
<td>sourceProjection</td>
<td>yes</td>
<td>String</td>
<td>-</td>
<td>the extent's projection</td>
<td>"EPSG:25832"</td>
</tr>
<tr>
<td>targetProjection</td>
<td>yes</td>
<td>String</td>
<td>-</td>
<td>projection expected by the <em>SensorThingsAPI</em> server</td>
<td>"EPSG:4326"</td>
</tr>
</tbody>
</table>
<p>See this basic implementation of <code>SensorThingsHttp</code> to receive data within the browser's current view extent only, using Masterportal events to show its functionality, as an example:</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="nx">SensorThingsHttp</span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@src/utils/sensorThingsHttp&quot;</span><span class="p">;</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="k">import</span><span class="w"> </span><span class="nx">LoaderOverlay</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;/src/utils/loaderOverlay&quot;</span><span class="p">;</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="kd">const</span><span class="w"> </span><span class="nx">http</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">SensorThingsHttp</span><span class="p">(),</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="w">    </span><span class="nx">extent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Radio</span><span class="p">.</span><span class="nx">request</span><span class="p">(</span><span class="s2">&quot;MapView&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;getCurrentExtent&quot;</span><span class="p">),</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="w">    </span><span class="nx">projection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Radio</span><span class="p">.</span><span class="nx">request</span><span class="p">(</span><span class="s2">&quot;MapView&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;getProjection&quot;</span><span class="p">).</span><span class="nx">getCode</span><span class="p">(),</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="w">    </span><span class="nx">epsg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;epsg&quot;</span><span class="p">),</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="w">    </span><span class="nx">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;https://iot.hamburg.de/v1.0/Things&quot;</span><span class="p">;</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="nx">http</span><span class="p">.</span><span class="nx">getInExtent</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a><span class="w">    </span><span class="nx">extent</span><span class="o">:</span><span class="w"> </span><span class="nx">extent</span><span class="p">,</span>
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a><span class="w">    </span><span class="nx">sourceProjection</span><span class="o">:</span><span class="w"> </span><span class="nx">projection</span><span class="p">,</span>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a><span class="w">    </span><span class="nx">targetProjection</span><span class="o">:</span><span class="w"> </span><span class="nx">epsg</span>
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a><span class="p">},</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">response</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-15"><a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a><span class="w">    </span><span class="c1">// on success</span>
</span><span id="__span-7-16"><a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a><span class="w">    </span><span class="c1">// do something with the response</span>
</span><span id="__span-7-17"><a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a>
</span><span id="__span-7-18"><a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a><span class="p">},</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-19"><a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a><span class="w">    </span><span class="c1">// on start (always called)</span>
</span><span id="__span-7-20"><a id="__codelineno-7-20" name="__codelineno-7-20" href="#__codelineno-7-20"></a><span class="w">    </span><span class="nx">LoaderOverlay</span><span class="p">.</span><span class="nx">show</span><span class="p">();</span>
</span><span id="__span-7-21"><a id="__codelineno-7-21" name="__codelineno-7-21" href="#__codelineno-7-21"></a>
</span><span id="__span-7-22"><a id="__codelineno-7-22" name="__codelineno-7-22" href="#__codelineno-7-22"></a><span class="p">},</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-23"><a id="__codelineno-7-23" name="__codelineno-7-23" href="#__codelineno-7-23"></a><span class="w">    </span><span class="c1">// on complete (always called)</span>
</span><span id="__span-7-24"><a id="__codelineno-7-24" name="__codelineno-7-24" href="#__codelineno-7-24"></a><span class="w">    </span><span class="nx">LoaderOverlay</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>
</span><span id="__span-7-25"><a id="__codelineno-7-25" name="__codelineno-7-25" href="#__codelineno-7-25"></a>
</span><span id="__span-7-26"><a id="__codelineno-7-26" name="__codelineno-7-26" href="#__codelineno-7-26"></a><span class="p">},</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-27"><a id="__codelineno-7-27" name="__codelineno-7-27" href="#__codelineno-7-27"></a><span class="w">    </span><span class="c1">// on error</span>
</span><span id="__span-7-28"><a id="__codelineno-7-28" name="__codelineno-7-28" href="#__codelineno-7-28"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-7-29"><a id="__codelineno-7-29" name="__codelineno-7-29" href="#__codelineno-7-29"></a>
</span><span id="__span-7-30"><a id="__codelineno-7-30" name="__codelineno-7-30" href="#__codelineno-7-30"></a><span class="p">},</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">progress</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-31"><a id="__codelineno-7-31" name="__codelineno-7-31" href="#__codelineno-7-31"></a><span class="w">    </span><span class="c1">// on wait</span>
</span><span id="__span-7-32"><a id="__codelineno-7-32" name="__codelineno-7-32" href="#__codelineno-7-32"></a><span class="w">    </span><span class="c1">// the progress to update your progress bar with</span>
</span><span id="__span-7-33"><a id="__codelineno-7-33" name="__codelineno-7-33" href="#__codelineno-7-33"></a><span class="w">    </span><span class="c1">// to get the percentage use Math.round(progress * 100)</span>
</span><span id="__span-7-34"><a id="__codelineno-7-34" name="__codelineno-7-34" href="#__codelineno-7-34"></a><span class="p">});</span>
</span></code></pre></div>
<p>When using <code>SensorThingsHttp.getInExtent()</code>, the <code>url</code> and <code>extent</code> parameters are mandatory. To retrieve the response you need to set the third parameter as an on success function. The others are optional.</p>
<p>An optional eighth parameter <code>httpClient</code> exists that can be used to replace the default HTTP handler, which is <code>axios</code>. This optional <code>httpClient</code>, if used, must be a function with parameters <code>url</code>, <code>onsuccess</code>, and <code>onerror</code>.</p>
<h3 id="the-use-of-polygon">The use of <code>POLYGON</code><a class="headerlink" href="#the-use-of-polygon" title="Copy heading link to clipboard">🔗</a></h3>
<p>If you don't want to use <code>SensorThingsHttp</code> software layer to access sensors in the current map view, consider these hints for your convenience.</p>
<p>To receive data only in a specified extent, the <em>SensorThingsAPI</em> provides certain geospatial functions using <code>POINT</code> or <code>POLYGON</code> structures. See <a href="https://docs.opengeospatial.org/is/15-078r6/15-078r6.html#56">the documentation</a> for more details. You may set your extent by using such a <code>POLYGON</code>, using the Location of Things to filter them by,</p>
<p>Basic example:</p>
<p><a href="https://iot.hamburg.de/v1.0/Things?$filter=st_within(Locations/location,geography%27POLYGON%20((10.0270%2053.5695,10.0370%2053.5695,10.0370%2053.5795,10.0270%2053.5795,10.0270%2053.5695))%27)&amp;$expand=Locations">https://iot.hamburg.de/v1.0/Things?$filter=st_within(Locations/location,geography%27POLYGON%20((10.0270%2053.5695,10.0370%2053.5695,10.0370%2053.5795,10.0270%2053.5795,10.0270%2053.5695))%27)&amp;$expand=Locations</a></p>
<blockquote>
<p>⚠️ Convert your projection to the projection used by the <em>SensorThingsAPI</em>. If the server uses "EPSG:4326", but your Masterportal is set to "EPSG:25832", you must use OpenLayers (or <code>masterportalAPI/src/crs</code>, exporting a <code>transform</code> function) to convert the coordinates.</p>
</blockquote>
<p>Example to transform a Location from your current projection into "EPSG:4326":</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="k">import</span><span class="w"> </span><span class="nx">crs</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@masterportal/masterportalapi/src/crs&quot;</span><span class="p">;</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="kd">const</span><span class="w"> </span><span class="nx">extent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Radio</span><span class="p">.</span><span class="nx">request</span><span class="p">(</span><span class="s2">&quot;MapView&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;getCurrentExtent&quot;</span><span class="p">),</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="w">    </span><span class="nx">projection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Radio</span><span class="p">.</span><span class="nx">request</span><span class="p">(</span><span class="s2">&quot;MapView&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;getProjection&quot;</span><span class="p">).</span><span class="nx">getCode</span><span class="p">(),</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="w">    </span><span class="nx">epsg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">,</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="w">    </span><span class="nx">topLeftCorner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">crs</span><span class="p">.</span><span class="nx">transform</span><span class="p">(</span><span class="nx">projection</span><span class="p">,</span><span class="w"> </span><span class="nx">epsg</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="nx">x</span><span class="o">:</span><span class="w"> </span><span class="nx">extent</span><span class="p">[</span><span class="mf">0</span><span class="p">],</span><span class="w"> </span><span class="nx">y</span><span class="o">:</span><span class="w"> </span><span class="nx">extent</span><span class="p">[</span><span class="mf">1</span><span class="p">]}),</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="w">    </span><span class="nx">bottomRightCorner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">crs</span><span class="p">.</span><span class="nx">transform</span><span class="p">(</span><span class="nx">projection</span><span class="p">,</span><span class="w"> </span><span class="nx">epsg</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="nx">x</span><span class="o">:</span><span class="w"> </span><span class="nx">extent</span><span class="p">[</span><span class="mf">2</span><span class="p">],</span><span class="w"> </span><span class="nx">y</span><span class="o">:</span><span class="w"> </span><span class="nx">extent</span><span class="p">[</span><span class="mf">3</span><span class="p">]});</span>
</span></code></pre></div>
<p>This way you will get the top left and bottom right corner of the view. To draw yourself a <code>POLYGON</code> to be used with <em>SensorThingsAPI</em> from that, the rectangle needs to be constructed as follows:</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">extent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Radio</span><span class="p">.</span><span class="nx">request</span><span class="p">(</span><span class="s2">&quot;MapView&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;getCurrentExtent&quot;</span><span class="p">),</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="w">    </span><span class="nx">polygon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="w">        </span><span class="p">{</span><span class="nx">x</span><span class="o">:</span><span class="w"> </span><span class="nx">extent</span><span class="p">[</span><span class="mf">0</span><span class="p">],</span><span class="w"> </span><span class="nx">y</span><span class="o">:</span><span class="w"> </span><span class="nx">extent</span><span class="p">[</span><span class="mf">1</span><span class="p">]},</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="w">        </span><span class="p">{</span><span class="nx">x</span><span class="o">:</span><span class="w"> </span><span class="nx">extent</span><span class="p">[</span><span class="mf">2</span><span class="p">],</span><span class="w"> </span><span class="nx">y</span><span class="o">:</span><span class="w"> </span><span class="nx">extent</span><span class="p">[</span><span class="mf">1</span><span class="p">]},</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="w">        </span><span class="p">{</span><span class="nx">x</span><span class="o">:</span><span class="w"> </span><span class="nx">extent</span><span class="p">[</span><span class="mf">2</span><span class="p">],</span><span class="w"> </span><span class="nx">y</span><span class="o">:</span><span class="w"> </span><span class="nx">extent</span><span class="p">[</span><span class="mf">3</span><span class="p">]},</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="w">        </span><span class="p">{</span><span class="nx">x</span><span class="o">:</span><span class="w"> </span><span class="nx">extent</span><span class="p">[</span><span class="mf">0</span><span class="p">],</span><span class="w"> </span><span class="nx">y</span><span class="o">:</span><span class="w"> </span><span class="nx">extent</span><span class="p">[</span><span class="mf">3</span><span class="p">]},</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="w">        </span><span class="p">{</span><span class="nx">x</span><span class="o">:</span><span class="w"> </span><span class="nx">extent</span><span class="p">[</span><span class="mf">0</span><span class="p">],</span><span class="w"> </span><span class="nx">y</span><span class="o">:</span><span class="w"> </span><span class="nx">extent</span><span class="p">[</span><span class="mf">1</span><span class="p">]}</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="w">    </span><span class="p">];</span>
</span></code></pre></div>
<h2 id="sensorthingsmqtt">SensorThingsMqtt<a class="headerlink" href="#sensorthingsmqtt" title="Copy heading link to clipboard">🔗</a></h2>
<p>The Masterportal SensorThings software layer is capable of handling mqtt subscriptions for <code>mqtt 3.1</code>, <code>mqtt 3.1.1</code>, and <code>mqtt 5.0</code>. The mqtt version running on the server to be used has to be known and used in <code>SensorThingsMqtt</code>'s constructor.</p>
<p>This is a basic example for <code>mqtt 5.0</code>:</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="nx">SensorThingsMqtt</span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;./sensorThingsMqtt&quot;</span><span class="p">;</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="kd">const</span><span class="w"> </span><span class="nx">mqtt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">SensorThingsMqtt</span><span class="p">({</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="w">        </span><span class="nx">mqttUrl</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;wss://iot.hamburg.de/mqtt&quot;</span><span class="p">,</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="w">        </span><span class="nx">mqttVersion</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;5.0&quot;</span><span class="p">,</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="w">        </span><span class="nx">context</span><span class="o">:</span><span class="w"> </span><span class="k">this</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="nx">mqtt</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">topic</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="p">,</span><span class="w"> </span><span class="nx">packet</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="w">    </span><span class="c1">// handler</span>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;received message:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">topic</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="p">,</span><span class="w"> </span><span class="nx">packet</span><span class="p">);</span>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a><span class="p">},</span><span class="w"> </span><span class="nx">error</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a><span class="w">    </span><span class="c1">// onerror</span>
</span><span id="__span-10-14"><a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-10-15"><a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a><span class="p">});</span>
</span><span id="__span-10-16"><a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a>
</span><span id="__span-10-17"><a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a><span class="nx">mqtt</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="s2">&quot;v1.0/Datastreams(1234)/Observations&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-18"><a id="__codelineno-10-18" name="__codelineno-10-18" href="#__codelineno-10-18"></a><span class="w">    </span><span class="nx">rh</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span>
</span><span id="__span-10-19"><a id="__codelineno-10-19" name="__codelineno-10-19" href="#__codelineno-10-19"></a><span class="p">},</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-20"><a id="__codelineno-10-20" name="__codelineno-10-20" href="#__codelineno-10-20"></a><span class="w">    </span><span class="c1">// onsuccess</span>
</span><span id="__span-10-21"><a id="__codelineno-10-21" name="__codelineno-10-21" href="#__codelineno-10-21"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;success&quot;</span><span class="p">);</span>
</span><span id="__span-10-22"><a id="__codelineno-10-22" name="__codelineno-10-22" href="#__codelineno-10-22"></a><span class="p">},</span><span class="w"> </span><span class="nx">error</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-23"><a id="__codelineno-10-23" name="__codelineno-10-23" href="#__codelineno-10-23"></a><span class="w">    </span><span class="c1">// onerror</span>
</span><span id="__span-10-24"><a id="__codelineno-10-24" name="__codelineno-10-24" href="#__codelineno-10-24"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-10-25"><a id="__codelineno-10-25" name="__codelineno-10-25" href="#__codelineno-10-25"></a><span class="p">});</span>
</span></code></pre></div>
<p>This is a basic example for <code>mqtt 3.1</code> and <code>3.1.1</code>:</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="nx">SensorThingsMqtt</span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;./sensorThingsMqtt&quot;</span><span class="p">;</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="kd">const</span><span class="w"> </span><span class="nx">mqtt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">SensorThingsMqtt</span><span class="p">({</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="w">        </span><span class="nx">mqttUrl</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;wss://iot.hamburg.de/mqtt&quot;</span><span class="p">,</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="w">        </span><span class="nx">mqttVersion</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;3.1.1&quot;</span><span class="p">,</span><span class="w"> </span><span class="c1">// &quot;3.1&quot; respective</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="w">        </span><span class="nx">rhPath</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;https://iot.hamburg.de&quot;</span><span class="p">,</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="w">        </span><span class="nx">context</span><span class="o">:</span><span class="w"> </span><span class="k">this</span>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a>
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a><span class="nx">mqtt</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">topic</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="p">,</span><span class="w"> </span><span class="nx">packet</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-11"><a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a><span class="w">    </span><span class="c1">// handler</span>
</span><span id="__span-11-12"><a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;received message:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">topic</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="p">,</span><span class="w"> </span><span class="nx">packet</span><span class="p">);</span>
</span><span id="__span-11-13"><a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a><span class="p">},</span><span class="w"> </span><span class="nx">error</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-14"><a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a><span class="w">    </span><span class="c1">// onerror</span>
</span><span id="__span-11-15"><a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-11-16"><a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a><span class="p">});</span>
</span><span id="__span-11-17"><a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a>
</span><span id="__span-11-18"><a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a><span class="nx">mqtt</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="s2">&quot;v1.0/Datastreams(1234)/Observations&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-19"><a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a><span class="w">    </span><span class="nx">rh</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span>
</span><span id="__span-11-20"><a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a><span class="p">},</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-21"><a id="__codelineno-11-21" name="__codelineno-11-21" href="#__codelineno-11-21"></a><span class="w">    </span><span class="c1">// onsuccess</span>
</span><span id="__span-11-22"><a id="__codelineno-11-22" name="__codelineno-11-22" href="#__codelineno-11-22"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;success&quot;</span><span class="p">);</span>
</span><span id="__span-11-23"><a id="__codelineno-11-23" name="__codelineno-11-23" href="#__codelineno-11-23"></a><span class="p">},</span><span class="w"> </span><span class="nx">error</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-24"><a id="__codelineno-11-24" name="__codelineno-11-24" href="#__codelineno-11-24"></a><span class="w">    </span><span class="c1">// onerror</span>
</span><span id="__span-11-25"><a id="__codelineno-11-25" name="__codelineno-11-25" href="#__codelineno-11-25"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-11-26"><a id="__codelineno-11-26" name="__codelineno-11-26" href="#__codelineno-11-26"></a><span class="p">});</span>
</span></code></pre></div>
<p>Please note that Messages are not received when using "subscribe", but will come in via an <code>on(message)</code> event.</p>
<p>The <code>on(message)</code> event's messages must be redirected to your processes with help of the supplied topics.</p>
<h3 id="configuration-constructor">Configuration - Constructor<a class="headerlink" href="#configuration-constructor" title="Copy heading link to clipboard">🔗</a></h3>
<p>The software layer <code>SensorThingsMqtt</code> is a class to be configured at construction time. Creating a new instance, the connection to the mqtt Server is established once per instance in the background.</p>
<table>
<thead>
<tr>
<th>name</th>
<th>mandatory</th>
<th>type</th>
<th>default</th>
<th>description</th>
<th>example</th>
</tr>
</thead>
<tbody>
<tr>
<td>mqttUrl</td>
<td>yes</td>
<td>String</td>
<td>""</td>
<td>The url to your mqtt server.</td>
<td>"wss://iot.hamburg.de/mqtt"</td>
</tr>
<tr>
<td>mqttVersion</td>
<td>no</td>
<td>String</td>
<td>"3.1.1"</td>
<td>The mqtt version your server runs on.</td>
<td>"3.1", "3.1.1", "5.0"</td>
</tr>
<tr>
<td>rhPath</td>
<td>no</td>
<td>String</td>
<td>""</td>
<td>For 3.1 and 3.1.1 only, you need to set the basic http path to your <em>SensorThingsAPI</em> to simulate Retained Handling.</td>
<td>"https://iot.hamburg.de"</td>
</tr>
<tr>
<td>context</td>
<td>no</td>
<td>JavaScript Scope</td>
<td>The scope to run the events in.</td>
<td>If you set the context to <code>this</code>, you can use <code>this</code> in your event functions to reach your current module.</td>
<td>this</td>
</tr>
</tbody>
</table>
<h4 id="mqtturl">mqttUrl<a class="headerlink" href="#mqtturl" title="Copy heading link to clipboard">🔗</a></h4>
<p>mqttUrl is the URL to connect to the mqtt service. The URL may use any of the protocols 'mqtt', 'mqtts', 'tcp', 'tls', 'ws', or 'wss'. See the <a href="https://www.npmjs.com/package/mqtt">mqtt package documentation</a> for additional details.</p>
<h4 id="mqttversion">mqttVersion<a class="headerlink" href="#mqttversion" title="Copy heading link to clipboard">🔗</a></h4>
<p>The mqttVersion will trigger different behavior of the <code>SensorThingsMqtt</code> software layer.</p>
<ul>
<li>"3.1": the internal protocolId is "MQIsdp" (3.1.1 and 5.0 use "MQTT"); the internal protocolVersion is 3 (3.1.1 and 5.0 use protocolVersion 4); simulation of Retained Handling will be activated if you provide a rhPath</li>
<li>"3.1.1": simulation of Retained Handling will be activated if you provide a rhPath</li>
<li>"5.0": no simulation of Retained Handling necessary (you must not provide a rhPath!), the event <code>on("disconnect")</code> is provided as feature for 5.0</li>
</ul>
<h4 id="rhpath">rhPath<a class="headerlink" href="#rhpath" title="Copy heading link to clipboard">🔗</a></h4>
<p>The rhPath is used to simulate Retained Handling on mqtt versions 3.1 and 3.1.1, and has to be set to protocol plus domain. To figure out your rhPath, think of it as the missing prefix for a Topic.</p>
<p>E.g., if you accessed your <em>SensorThingsAPI</em> via "https://iot.hamburg.de/v1.0/Things(1234)/Datastreams", you'd subscribe to a Topic via mqtt with "v1.0/Things(1234)/Datastreams". The rhPath is the leftover URL part missing to actually receive data via http. In this case, "https://iot.hamburg.de" is the rhPath.</p>
<p>Be aware that your http path might differ from your mqtt path depending on the protocol to be used; e.g. "wss://iot.hamburg.de/mqtt" could be an rhPath to subscribe to "v1.0/Things(1234)/Datastreams".</p>
<p>Examples:
 - <em>SensorThingsAPI</em>: "https://iot.hamburg.de/v1.0/Things(1234)/Datastreams"
 - mqttUrl: "wss://iot.hamburg.de/mqtt"
 - Topic: "v1.0/Things(1234)/Datastreams"
 - rhPath: "https://iot.hamburg.de"</p>
<h3 id="configuration-subscribe">Configuration - Subscribe<a class="headerlink" href="#configuration-subscribe" title="Copy heading link to clipboard">🔗</a></h3>
<p>After construction, you can subscribe using the instance of <code>SensorThingsMqtt</code>.</p>
<table>
<thead>
<tr>
<th>name</th>
<th>mandatory</th>
<th>type</th>
<th>default</th>
<th>description</th>
<th>example</th>
</tr>
</thead>
<tbody>
<tr>
<td>qos</td>
<td>no</td>
<td>Number</td>
<td>0</td>
<td>Quality of service subscription level, <a href="https://docs.oasis-open.org/mqtt/mqtt/v5.0/os/mqtt-v5.0-os.html#_Toc3901169">see documentation</a>.</td>
<td>0, 1, or 2</td>
</tr>
<tr>
<td>rh</td>
<td>no</td>
<td>Number</td>
<td>2</td>
<td>"This option specifies whether retained messages are sent on subscription." (<a href="https://docs.oasis-open.org/mqtt/mqtt/v5.0/os/mqtt-v5.0-os.html#_Toc3901169">source</a>)</td>
<td>0, 1, or 2</td>
</tr>
</tbody>
</table>
<h4 id="rh">rh<a class="headerlink" href="#rh" title="Copy heading link to clipboard">🔗</a></h4>
<p>Retained Handling (rh) between Client and Server is only available for mqtt 5.0, since previous version to not support this feature.</p>
<p>However, for 3.1 and 3.1.1, <code>SensorThingsMqtt</code> may simulate Retained Messages by bypassing mqtt with http, internally using <code>SensorThingsHttp</code> to receive the latest sensor message.</p>
<p>The Retained Handling can be configured as rh := 0, 1, or 2.</p>
<ul>
<li>rh := 0; On subscription, you'll receive one old message (the latest message) from the Sensor immediately by message event.</li>
<li>rh := 1; On subscription, you'll receive one old message (the latest message), but only if it's the first process in the application to subscribe to this topic.</li>
<li>rh := 2; On subscription, you will not receive any latest message of the Sensor, but "fresh" messages in the future.</li>
</ul>
<h3 id="retained-handling">Retained Handling<a class="headerlink" href="#retained-handling" title="Copy heading link to clipboard">🔗</a></h3>
<p>An important option for mqtt subscriptions is the so-called "Retained Handling" (rh).</p>
<p>A "Retained Message" is a Sensor message sent in the past, but stored by the server to send immediately after subscription.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="nx">SensorThingsMqtt</span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;./sensorThingsMqtt&quot;</span><span class="p">;</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="kd">const</span><span class="w"> </span><span class="nx">mqtt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">SensorThingsMqtt</span><span class="p">({</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="w">        </span><span class="nx">mqttUrl</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;wss://iot.hamburg.de/mqtt&quot;</span><span class="p">,</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="w">        </span><span class="nx">mqttVersion</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;5.0&quot;</span><span class="p">,</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="w">        </span><span class="nx">context</span><span class="o">:</span><span class="w"> </span><span class="k">this</span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="nx">mqtt</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">topic</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="p">,</span><span class="w"> </span><span class="nx">packet</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">packet</span><span class="p">.</span><span class="nx">retain</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;this is a retained message&quot;</span><span class="p">);</span>
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a><span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-14"><a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;this is a new message&quot;</span><span class="p">);</span>
</span><span id="__span-12-15"><a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-12-16"><a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a><span class="p">});</span>
</span><span id="__span-12-17"><a id="__codelineno-12-17" name="__codelineno-12-17" href="#__codelineno-12-17"></a>
</span><span id="__span-12-18"><a id="__codelineno-12-18" name="__codelineno-12-18" href="#__codelineno-12-18"></a><span class="nx">mqtt</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="s2">&quot;v1.0/Datastreams(1234)/Observations&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="nx">rh</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">});</span>
</span></code></pre></div>
<p>As this might be an unwanted behavior, Retained Handling is inactive by default, that is, rh is set to 2 by default.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="nx">SensorThingsMqtt</span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;./sensorThingsMqtt&quot;</span><span class="p">;</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="kd">const</span><span class="w"> </span><span class="nx">mqtt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">SensorThingsMqtt</span><span class="p">({</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="w">        </span><span class="nx">mqttUrl</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;wss://iot.hamburg.de/mqtt&quot;</span><span class="p">,</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="w">        </span><span class="nx">mqttVersion</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;5.0&quot;</span><span class="p">,</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="w">        </span><span class="nx">context</span><span class="o">:</span><span class="w"> </span><span class="k">this</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a><span class="nx">mqtt</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">topic</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="p">,</span><span class="w"> </span><span class="nx">packet</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">packet</span><span class="p">.</span><span class="nx">retain</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;this will never happen&quot;</span><span class="p">);</span>
</span><span id="__span-13-12"><a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-13-13"><a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a><span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-14"><a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;this is a new message&quot;</span><span class="p">);</span>
</span><span id="__span-13-15"><a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-13-16"><a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a><span class="p">});</span>
</span><span id="__span-13-17"><a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a>
</span><span id="__span-13-18"><a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a><span class="nx">mqtt</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="s2">&quot;v1.0/Datastreams(1234)/Observations&quot;</span><span class="p">);</span>
</span></code></pre></div>
<p>To identify whether a message is a Retained Message, check the <code>packet.retain</code> flag included.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="nx">SensorThingsMqtt</span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;./sensorThingsMqtt&quot;</span><span class="p">;</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="kd">const</span><span class="w"> </span><span class="nx">mqtt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">SensorThingsMqtt</span><span class="p">({</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="w">        </span><span class="nx">mqttUrl</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;wss://iot.hamburg.de/mqtt&quot;</span><span class="p">,</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="w">        </span><span class="nx">mqttVersion</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;5.0&quot;</span><span class="p">,</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="w">        </span><span class="nx">context</span><span class="o">:</span><span class="w"> </span><span class="k">this</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="nx">mqtt</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">topic</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="p">,</span><span class="w"> </span><span class="nx">packet</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">topic</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s2">&quot;v1.0/Datastreams(1234)/Observations&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">packet</span><span class="p">.</span><span class="nx">retain</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;this is for the second subscription only&quot;</span><span class="p">);</span>
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a><span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">topic</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s2">&quot;v1.0/Datastreams(1234)/Observations&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-14"><a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;this is for the first and second subscription&quot;</span><span class="p">);</span>
</span><span id="__span-14-15"><a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-14-16"><a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a><span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">topic</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s2">&quot;v1.0/Things(4321)/Datastreams&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-17"><a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;this is for the third subscription, retain flag is&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">packet</span><span class="p">.</span><span class="nx">retain</span><span class="p">);</span>
</span><span id="__span-14-18"><a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-14-19"><a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a><span class="p">});</span>
</span><span id="__span-14-20"><a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a>
</span><span id="__span-14-21"><a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a><span class="c1">// first subscription</span>
</span><span id="__span-14-22"><a id="__codelineno-14-22" name="__codelineno-14-22" href="#__codelineno-14-22"></a><span class="nx">mqtt</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="s2">&quot;v1.0/Datastreams(1234)/Observations&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="nx">rh</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="p">});</span>
</span><span id="__span-14-23"><a id="__codelineno-14-23" name="__codelineno-14-23" href="#__codelineno-14-23"></a>
</span><span id="__span-14-24"><a id="__codelineno-14-24" name="__codelineno-14-24" href="#__codelineno-14-24"></a><span class="c1">// second subscription</span>
</span><span id="__span-14-25"><a id="__codelineno-14-25" name="__codelineno-14-25" href="#__codelineno-14-25"></a><span class="nx">mqtt</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="s2">&quot;v1.0/Datastreams(1234)/Observations&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="nx">rh</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">});</span>
</span><span id="__span-14-26"><a id="__codelineno-14-26" name="__codelineno-14-26" href="#__codelineno-14-26"></a>
</span><span id="__span-14-27"><a id="__codelineno-14-27" name="__codelineno-14-27" href="#__codelineno-14-27"></a><span class="c1">// third subscription</span>
</span><span id="__span-14-28"><a id="__codelineno-14-28" name="__codelineno-14-28" href="#__codelineno-14-28"></a><span class="nx">mqtt</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="s2">&quot;v1.0/Things(4321)/Datastreams&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="nx">rh</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">});</span>
</span></code></pre></div>
<h3 id="closing-a-mqtt-connection">Closing a mqtt connection<a class="headerlink" href="#closing-a-mqtt-connection" title="Copy heading link to clipboard">🔗</a></h3>
<p>To close a mqtt connection, execute <code>end</code> on the <code>SensorThingsMqtt</code> instance.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="nx">SensorThingsMqtt</span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;./sensorThingsMqtt&quot;</span><span class="p">;</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="kd">const</span><span class="w"> </span><span class="nx">mqtt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">SensorThingsMqtt</span><span class="p">({</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="w">        </span><span class="nx">mqttUrl</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;wss://iot.hamburg.de/mqtt&quot;</span><span class="p">,</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="w">        </span><span class="nx">mqttVersion</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;5.0&quot;</span><span class="p">,</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="w">        </span><span class="nx">context</span><span class="o">:</span><span class="w"> </span><span class="k">this</span>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a><span class="nx">mqtt</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="p">{},</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;finished&quot;</span><span class="p">);</span>
</span><span id="__span-15-11"><a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a><span class="p">});</span>
</span></code></pre></div>
<p>For more information on the <code>end</code> function parameters, visit <a href="https://www.npmjs.com/package/mqtt#end">the end function documentation of mqtt</a>; this called is passed through to the mqtt package without further effects.</p>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://www.masterportal.org/home.html" target="_blank" rel="noopener" title="www.masterportal.org" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M256 512a256 256 0 1 0 0-512 256 256 0 1 0 0 512zm-40-176h24v-64h-24c-13.3 0-24-10.7-24-24s10.7-24 24-24h48c13.3 0 24 10.7 24 24v88h8c13.3 0 24 10.7 24 24s-10.7 24-24 24h-80c-13.3 0-24-10.7-24-24s10.7-24 24-24zm40-208a32 32 0 1 1 0 64 32 32 0 1 1 0-64z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://bitbucket.org/geowerkstatt-hamburg/masterportal/" target="_blank" rel="noopener" title="bitbucket.org" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M22.2 32A16 16 0 0 0 6 47.8a26.35 26.35 0 0 0 .2 2.8l67.9 412.1a21.77 21.77 0 0 0 21.3 18.2h325.7a16 16 0 0 0 16-13.4L505 50.7a16 16 0 0 0-13.2-18.3 24.58 24.58 0 0 0-2.8-.2L22.2 32zm285.9 297.8h-104l-28.1-147h157.3l-25.2 147z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["content.action.edit", "content.code.annotate", "content.code.copy", "content.tabs.link", "content.tooltips", "navigation.tabs", "navigation.tabs.sticky", "navigation.tracking", "navigation.sections", "navigation.top", "navigation.instant", "search.share", "search.suggest", "toc.follow"], "search": "../../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.cd18aaf1.min.js"></script>
      
        <script src="../../../_docsCustomization/js/copyHeadingLinkToClipboard.js"></script>
      
    
  </body>
</html>